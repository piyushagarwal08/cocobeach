var ERE=ERE||{};!function($){"use strict";var ajax_url=ere_main_vars.ajax_url,confirm_yes_text=ere_main_vars.confirm_yes_text,confirm_no_text=ere_main_vars.confirm_no_text,loading_text=ere_main_vars.loading_text,decimals=ere_main_vars.decimals,dec_point=ere_main_vars.dec_point,thousands_sep=ere_main_vars.thousands_sep;ERE={init:function(){this.favorite(),this.tooltip(),this.property_paging(),this.move_link_to_carousel(),this.execute_nav(),this.execute_slider_nav();var a=$(".pagination-image.ere-property-slider");this.sync_property_carousel(a),this.light_gallery()},number_format:function(a,b){b=void 0!==b?b:decimals,a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var c=isFinite(+a)?+a:0,d=isFinite(+b)?Math.abs(b):0,e=void 0===thousands_sep?",":thousands_sep,f=void 0===dec_point?".":dec_point,g="",h=function(a,b){var c=Math.pow(10,b);return""+Math.round(a*c)/c};return g=(d?h(c,d):""+Math.round(c)).split("."),g[0].length>3&&(g[0]=g[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,e)),(g[1]||"").length<d&&(g[1]=g[1]||"",g[1]+=new Array(d-g[1].length+1).join("0")),g.join(f)},tooltip:function(){$('[data-toggle="tooltip"]').tooltip()},login_modal:function(){$("#ere_signin_modal").modal("show")},get_page_number_from_href:function(a){var b="",c=/paged=\d+/gi;return new RegExp(c).test(a)?b=new RegExp(c).exec(a):(c=/page\/\d+/gi,b=new RegExp(c).test(a)?new RegExp(c).exec(a):b),c=/\d+/g,new RegExp(c).test(b)?new RegExp(c).exec(b)[0]:1},favorite:function(){$(".property-favorite").on("click",function(e){if(e.preventDefault(),!$(this).hasClass("on-handle")){var $this=$(this).addClass("on-handle"),property_inner=$this.closest(".property-inner").addClass("property-active-hover"),property_id=$this.attr("data-property-id"),title_not_favorite=$this.attr("data-title-not-favorite"),title_favorited=$this.attr("data-title-favorited");$.ajax({type:"post",url:ajax_url,dataType:"json",data:{action:"ere_favorite_ajax",property_id:property_id},beforeSend:function(){$this.children("i").addClass("fa-spinner fa-spin")},success:function(a){a.added?($this.children("i").removeClass("fa-star-o").addClass("fa-star"),$this.attr("data-original-title",title_favorited)):($this.children("i").removeClass("fa-star").addClass("fa-star-o"),$this.attr("data-original-title",title_not_favorite)),$this.children("i").removeClass("fa-spinner fa-spin"),void 0===a.added&&ERE.login_modal(),$this.removeClass("on-handle"),property_inner.removeClass("property-active-hover")},error:function(xhr){var err=eval("("+xhr.responseText+")");console.log(err.Message),$this.children("i").removeClass("fa-spinner fa-spin"),$this.removeClass("on-handle"),property_inner.removeClass("property-active-hover")}})}})},light_gallery:function(){$("[data-rel='ere_light_gallery']").each(function(){var a=$(this),b=a.data("gallery-id");a.on("click",function(c){c.preventDefault();var d=[],e=0,f=$(this).attr("href"),g=$(this).data("thumb-src");void 0!==b&&($('[data-gallery-id="'+b+'"]').each(function(a){var b=$(this).attr("href"),c=$(this).data("thumb-src"),h=$(this).attr("title");b==f&&c==g&&(e=a),void 0===h&&(h=""),d.push({src:b,downloadUrl:b,thumb:c,subHtml:h})}),a.lightGallery({hash:!1,galleryId:b,dynamic:!0,dynamicEl:d,thumbWidth:80,index:e}))})}),$("a.ere-view-video").on("click",function(a){a.preventDefault();var b=$(this).attr("data-src");$(this).lightGallery({dynamic:!0,dynamicEl:[{src:b,thumb:"",subHtml:""}]})})},show_loading:function(a){"undefined"!=a&&""!=a&&null!=a||(a=loading_text);var b=wp.template("ere-processing-template");$("body").append(b({ico:"fa fa-spinner fa-spin",text:a}))},change_loading_status:function(a,b){$("i",".ere-processing").removeClass("fa-spinner fa-spin").addClass(a),$("span",".ere-processing").text(b)},close_loading:function(a){void 0!==a&&null!=a||(a=500),0==a?$(".ere-processing").remove():setTimeout(function(){$(".ere-processing").fadeOut(function(){$(".ere-processing").remove()})},a)},popup_alert:function(a,b,c){var d=wp.template("ere-dialog-template");$("body").append(d({ico:a,message:c})),$("#ere-dialog-popup").dialog({title:b,resizable:!1,closeOnEscape:!0,modal:!0,buttons:{Ok:function(){$(this).dialog("close"),$(this).dialog("destroy").remove()}}})},confirm_dialog:function(a,b,c,d){var e=wp.template("ere-dialog-template");$("body").append(e({ico:"fa fa-question-circle",message:b})),$("#ere-dialog-popup").dialog({title:a,resizable:!1,closeOnEscape:!0,modal:!0,buttons:[{text:confirm_yes_text,click:function(){c&&c(),$(this).dialog("destroy").remove()}},{text:confirm_no_text,click:function(){d&&d(),$(this).dialog("close"),$(this).dialog("destroy").remove()}}]})},set_item_effect:function(a,b){if("hide"==b&&(a.css("transition","opacity 1.5s linear, transform 1s"),a.css("-webkit-transition","opacity 1.5s linear, transform 1s"),a.css("-moz-transition","opacity 1.5s linear, transform 1s"),a.css("-ms-transition","opacity 1.5s linear, transform 1s"),a.css("-o-transition","opacity 1.5s linear, transform 1s"),a.css("opacity",0),a.css("transform","scale(0.2)"),a.css("-ms-transform","scale(0.2)"),a.css("-webkit-transform","scale(0.2)")),"show"==b)for(var c=0;c<a.length;c++)!function(b){var d=100*c;setTimeout(function(){$(a[b]).css("opacity",1),$(a[b]).css("transform","scale(1)"),$(a[b]).css("-ms-transform","scale(1)"),$(a[b]).css("-webkit-transform","scale(1)")},d)}(c)},select_term:function(){var a=$("select.property-filter-mb");a.off(),$(a).on("change",function(a){var b=$(this);b.attr("disabled","disabled"),a.preventDefault();var c=$("option:selected",b).attr("value");b.parent().prev().children('[data-filter="'+c+'"]').click()})},contact_agent_by_email:function(){$(".agent-contact-btn","#contact-agent-form").each(function(){$(this).on("click",function(a){a.preventDefault();var b=$(this),c=b.closest("#contact-agent-form"),d=$('[name="target-email"]',c).val(),e=$('[name="property-url"]',c).val(),f=$('[name="name"]',c).val(),g=$('[name="phone"]',c).val(),h=$('[name="email"]',c).val(),i=$('[name="message"]',c).val(),j=!1;0===f.trim().length?($(".name-error",c).removeClass("hidden"),j=!0):$(".name-error",c).hasClass("hidden")||$(".name-error",c).addClass("hidden"),0===g.trim().length?($(".phone-error",c).removeClass("hidden"),j=!0):$(".phone-error",c).hasClass("hidden")||$(".phone-error",c).addClass("hidden");var k=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;0!==h.trim().length&&k.test(h)?$(".email-error",c).hasClass("hidden")||$(".email-error",c).addClass("hidden"):($(".email-error",c).removeClass("hidden"),0===h.trim().length||k.test(h)?$(".email-error",c).text($(".email-error",c).data("error")):$(".email-error",c).text($(".email-error",c).data("not-valid")),j=!0),0===i.trim().length?($(".message-error",c).removeClass("hidden"),j=!0):$(".message-error",c).hasClass("hidden")||$(".message-error",c).addClass("hidden"),b.button({loadingText:'<span class="fa fa-spinner fa-spin"></span>'}),j||(b.button("loading"),$.ajax({type:"post",url:c.attr("action"),data:{action:"ere_contact_agent_ajax",target_email:d,property_url:e,sender_name:f,sender_phone:g,sender_email:h,sender_msg:i},success:function(a){$(".form-messages",c).text(a),b.button("reset")},error:function(){b.button("reset")}}))})})},property_paging:function(){var handle=!0;$(".paging-navigation",".property-paging-wrap").each(function(){$("a",$(this)).button({loadingText:'<span class="fa fa-spinner fa-spin"></span>'}),$("a",$(this)).off("click").on("click",function(event){if(event.preventDefault(),handle){handle=!1;var $this=$(this);$this.css({padding:"0px",height:$this.outerHeight(),width:$this.outerWidth()}),$this.button("loading");var href=$this.attr("href"),data_paged=ERE.get_page_number_from_href(href),data_contain=$this.closest(".property-paging-wrap"),property_content=$this.closest(".ere-property").find(".property-content");$.ajax({url:data_contain.data("admin-url"),data:{action:"ere_property_paging_ajax",layout:data_contain.data("layout"),items_amount:data_contain.data("items-amount"),columns:data_contain.data("columns"),image_size:data_contain.data("image-size"),columns_gap:data_contain.data("columns-gap"),view_all_link:data_contain.data("view-all-link"),paged:data_paged,author_id:data_contain.data("author-id"),agent_id:data_contain.data("agent-id")},success:function(a){var b=$(".property-item",a),c=$(".property-paging-wrap",a);property_content.css("opacity",0),property_content.html(b),ERE.set_item_effect(b,"hide");var d=property_content.offset().top-30;$("html,body").animate({scrollTop:+d+"px"},500),property_content.css("opacity",1),property_content.imagesLoaded(function(){b=$(".property-item",property_content),ERE.set_item_effect(b,"show"),property_content.closest(".ere-property").find(".property-paging-wrap").html(c.html()),ERE.property_paging(),ERE.property_paging_control(),ERE.favorite(),ERE.tooltip(),ERE_Compare.register_event_compare()}),$this.css({height:"auto",width:"auto",padding:""}),$this.button("reset"),handle=!0},error:function(xhr){var err=eval("("+xhr.responseText+")");console.log(err.Message),$this.css({height:"auto",width:"auto",padding:""}),$this.button("reset"),handle=!0}})}})})},property_paging_control:function(){$(".paging-navigation",".ere-property").each(function(){var a=$(this);0===a.find("a.next").length?a.addClass("next-disable"):a.removeClass("next-disable")})},move_link_to_carousel:function(){$(".property-carousel").each(function(){var a=$(this);$(".owl-carousel",a).on("owlInitialized",function(){if(void 0!=a.data("view-all-link")&&(a.children(".owl-loaded").hasClass("owl-nav-top-right")||a.children(".owl-loaded").hasClass("owl-nav-bottom-center"))){var b=a.find(".view-all-link");b.length>0&&!a.find(".owl-nav").hasClass("disabled")&&(b.removeClass("mg-top-60 sm-mg-top-40"),a.find(".owl-nav").addClass("has-view-all"),a.find(".owl-nav").append(b[0].outerHTML),b.remove())}a.hasClass("owl-move-nav-par-with-heading")&&a.find(".ere-heading").length>0&&!a.find(".ere-heading").hasClass("heading-contain-owl-nav")&&(a.find(".ere-heading").addClass("heading-contain-owl-nav"),a.find(".owl-nav").addClass("owl-nav-top-right").insertAfter(a.find(".ere-heading").children("h2")))})})},execute_nav:function(){$(".ere-property-carousel").each(function(){var a=$(this),b=$(".navigation-wrap",a),c=$(".owl-carousel .property-item",a);ERE.ere_calc_column_padding(b,c),$(".owl-carousel",a).on("owlInitialized",function(){var a=$(this),c=$(".owl-nav",a);b.length>0&&c.length>0&&c.detach().appendTo(b),ERE.ere_calc_column_padding(b,$(".property-item",a))})})},ere_calc_column_padding:function(a,b){if(a.height()<b.height()){var c=Math.floor((b.height()-a.height())/2);a.css({"padding-top":c+"px","padding-bottom":c+"px"})}},execute_slider_nav:function(){$(".ere-property-slider.navigation-middle").each(function(){ERE.ere_calc_nav_top($(".owl-carousel",$(this))),$(".owl-carousel",$(this)).on("owlInitialized",function(){var a=$(this);$(".owl-nav",a).addClass("container"),setTimeout(function(){ERE.ere_calc_nav_top(a)},20)})})},ere_calc_nav_top:function(a){var b=$(".owl-nav",a),c=$(".property-item",a).outerHeight(),d=$(".block-center-inner",a).outerHeight(),e=Math.floor((c-d)/2);b.css("top",e+"px")},sync_property_carousel:function(a){function e(a){var b=a.item.index;d.find(".owl-item").removeClass("current").eq(b).addClass("current");var c=d.find(".owl-item.active").length-1,e=d.find(".owl-item.active").first().index();b>d.find(".owl-item.active").last().index()&&d.data("owl.carousel").to(b,500,!0),b<e&&d.data("owl.carousel").to(b-c,500,!0)}function f(a){var b=a.item.index;c.data("owl.carousel").to(b,500,!0)}var b=$("body").hasClass("rtl"),c=a.find(".property-content-slider"),d=a.find(".property-image-slider");c.owlCarousel({items:1,autoHeight:!0,nav:!1,dots:!1,loop:!1,smartSpeed:500,rtl:b}).on("changed.owl.carousel",e),d.on("initialized.owl.carousel",function(){d.find(".owl-item").eq(0).addClass("current")}).owlCarousel({nav:!1,dots:!1,rtl:b,margin:10,responsive:{992:{items:4},768:{items:3},480:{items:2},0:{items:1}}}).on("changed.owl.carousel",f),d.on("click",".owl-item",function(a){if(a.preventDefault(),!$(this).hasClass("current")){var b=$(this).index();c.data("owl.carousel").to(b,500,!0)}})}},$(document).ready(function(){ERE.init()}),$(window).resize(function(){setTimeout(ERE.execute_nav,20),setTimeout(function(){ERE.execute_slider_nav();var a=$(".pagination-image.ere-property-slider");ERE.sync_property_carousel(a)},10)})}(jQuery);